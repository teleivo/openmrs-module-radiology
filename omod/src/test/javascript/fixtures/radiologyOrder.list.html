<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:jsp="http://java.sun.com/JSP/Page" xmlns:spring="http://www.springframework.org/tags"
  xmlns:openmrs="urn:jsptld:/WEB-INF/taglibs/openmrs.tld">
<head>
<title>OpenMRS</title>
</head>

<body>
  <div id="pageBody">

    <div id="content">

      <!-- Add, Edit, Delete, View Orders -->
      <!-- Add, Edit, Delete, View Reports -->

      <ul id="menu">
        <li class="first"><a href="/openmrs/admin">Admin</a></li>

        <li class="active"><a href="/openmrs/module/radiology/radiologyOrder.list"> Manage Radiology Orders </a></li>




      </ul>

      <script type="text/javascript">
              var $j = jQuery.noConflict();
              $j(document)
                      .ready(
                              function() {
                                pQuery = $j('input[name="patientQuery"]');
                                loading = $j('div#openmrs_msg[name="loading"]');
                                startDate = $j('input[name="startDate"]');
                                endDate = $j('input[name="endDate"]');
                                find = $j('#findButton');
                                results = $j('#results');
                                clearResults = $j('a#clearResults');

                                function format(order_id, physician, status,
                                        instructions) {
                                  // `d` is the original data object for the row
                                  return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'
                                          + '<tr>'
                                          + '<td>Referring Physician</td>'
                                          + '<td>'
                                          + physician
                                          + '</td>'
                                          + '</tr>'
                                          + '<tr>'
                                          + '<td>Scheduled status</td>'
                                          + '<td>'
                                          + status
                                          + '</td>'
                                          + '</tr>'
                                          + '<tr>'
                                          + '<td>Instructions</td>'
                                          + '<td>'
                                          + instructions
                                          + '</td>'
                                          + '</tr>' + '</table>';
                                }

                                firstTime();
                                function firstTime() {
                                  sendRequest();
                                }

                                function sendRequest() {

                                  loading.show();
                                  $j('#errorSpan').html('');
                                  $j
                                          .get(
                                                  'portlets/orderSearch.portlet',
                                                  {
                                                    patientQuery: pQuery.val(),
                                                    startDate: startDate.val(),
                                                    endDate: endDate.val()
                                                  },
                                                  function(data) {
                                                    loading.hide();
                                                    // crossDate error span rendered/sended
                                                    // from portlet
                                                    if (data
                                                            .match(/crossDate/ig) != null) {
                                                      $j('#errorSpan').html(
                                                              $j(data));
                                                    }
                                                    // no errors
                                                    else {
                                                      // load data
                                                      results.html(data);
                                                      var oTable = $j(
                                                              'table#radiologyOrdersTable')
                                                              .DataTable(
                                                                      {
                                                                        "order": [[
                                                                            1,
                                                                            'asc']],
                                                                        "oLanguage": {
                                                                          "sLengthMenu": 'Show'
                                                                                  + ' _MENU_ entries',
                                                                          "sSearch": 'Search:',
                                                                          "sInfo": 'Viewing _START_ '
                                                                                  + '- _END_ '
                                                                                  + 'of _TOTAL_',
                                                                          "oPaginate": {
                                                                            "sFirst": 'first',
                                                                            "sPrevious": 'Previous',
                                                                            "sNext": 'Next',
                                                                            "sLast": 'last',
                                                                          },
                                                                          "sProcessing": 'Loading...'
                                                                        },
                                                                        "columnDefs": [
                                                                            {
                                                                              "sType": "num-html",
                                                                              "bSortable": true,
                                                                              "aTargets": [0]
                                                                            },
                                                                            {
                                                                              "targets": [8],
                                                                              "visible": false,
                                                                              "searchable": false
                                                                            },
                                                                            {
                                                                              "targets": [9],
                                                                              "visible": false,
                                                                              "searchable": false
                                                                            },
                                                                            {
                                                                              "targets": [10],
                                                                              "visible": false,
                                                                              "searchable": false
                                                                            }]
                                                                      });
                                                      $j(
                                                              '#radiologyOrdersTableBody')
                                                              .on(
                                                                      'click',
                                                                      'tr',
                                                                      function() {
                                                                        var tr = $j(this);
                                                                        var row = oTable
                                                                                .row(this);

                                                                        if (row.child
                                                                                .isShown()) {
                                                                          row.child
                                                                                  .hide();
                                                                          tr
                                                                                  .removeClass('shown');
                                                                        } else {
                                                                          row
                                                                                  .child(
                                                                                          format(
                                                                                                  tr
                                                                                                          .data('child-order_id'),
                                                                                                  tr
                                                                                                          .data('child-physician'),
                                                                                                  tr
                                                                                                          .data('child-status'),
                                                                                                  tr
                                                                                                          .data('child-instructions')),
                                                                                          'no-padding')
                                                                                  .show();
                                                                          tr
                                                                                  .addClass('shown');
                                                                        }
                                                                      });
                                                    }
                                                  });
                                }

                                // ***********Events*************
                                find.click(function() {
                                  page = 0;
                                  sendRequest();
                                });

                                pQuery.keypress(function(event) {
                                  if (event.which == '13') {
                                    sendRequest();
                                  }
                                });

                                clearResults
                                        .click(function() {
                                          $j('table#searchForm input:text')
                                                  .val('');
                                          $j('tbody#radiologyOrdersTableBody')
                                                  .html('');
                                        });
                              });
            </script>

      <script src="/openmrs/moduleResources/radiology/js/sortNumbers.js?v=1.11.4" type="text/javascript"></script>
      <link href="/openmrs/moduleResources/radiology/css/jquery.dataTables.min.css?v=1.11.4" type="text/css" rel="stylesheet" />
      <link href="/openmrs/moduleResources/radiology/css/details-control.dataTables.css?v=1.11.4" type="text/css"
        rel="stylesheet" />

      <div id="calendar"></div>

      <h2>Manage Radiology Orders</h2>
      <div id="openmrs_msg" name="loading">Loading...</div>

      <a href="radiologyOrder.form">Add Radiology Order</a> <br> <br> <span class="boxHeader"> <b>Radiology
          Orders</b> <a id="clearResults" href="#" style="float: right"> Clear Results </a>
      </span>
      <div class="box">
        <table id="searchForm" cellspacing="10">
          <tr>
            <form id="radiologyOrderListForm">
              <td><label>Patient:</label> <input name="patientQuery" type="text" style="width: 20em"
                title="Minimum 3 Chars" /></td>
              <td><label>Start Date:</label> <input name="startDate" type="text" onclick="showCalendar(this)" /></td>
              <td><label>End Date:</label> <input name="endDate" type="text" onclick="showCalendar(this)" /></td>
              <td><input id="findButton" type="button" value="Find" /></td>
              <td id="errorSpan"></td>
            </form>
          </tr>
        </table>
        <br>
        <div id="results"></div>

      </div>
      <br /> <br />
    </div>
  </div>

  <div id="footer" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:spring="http://www.springframework.org/tags">

    <div id="footerInner">



      <span id="localeOptions"> <a href="?&amp;lang=en_US">English (United States)</a> | <a href="?&amp;lang=en_GB">English
          (United Kingdom)</a>

      </span> <span id="buildDate">Last Build: 2015-09-21 20:38</span> <span id="codeVersion">Version: 1.11.4 Build 6ebcaf</span> <span
        id="poweredBy"><a href="http://openmrs.org">Powered by OpenMRS <img border="0" align="top"
          src="/openmrs/images/openmrs_logo_tiny.png" /></a></span>
    </div>
  </div>

</body>
</html>
